let e=null,t="en";const n={en:{mainTitle:"Alberta Family Income Analysis",subtitle:"Single Income Family - 2025",familySettingsTitle:"Family Information Settings",labelNumChildren:"Number of Children",btnCalculate:"Update Calculation",calculationNotesTitle:"Calculation Notes",familyInfoPrefix:"Family Status: Single Income",familyInfoNoChildren:"Family Status: Single Income, No Children",familyInfoWithChildren:"Family Status: Single Income, {count} children ({ages})",includesText:"Includes: Federal Tax, Alberta Provincial Tax, CPP, EI",ccbText:"CCB (Canada Child Benefit) calculated based on current year income",incomeRangeText:"Income Range: $20,000 - $150,000",taxRatesTitle:"2025 Tax Rates and Benefit Standards",federalTaxTitle:"Federal Tax Rates",federalBPAText:"Basic Personal Amount: $16,129",albertaTaxTitle:"Alberta Tax Rates",albertaBPAText:"Basic Personal Amount: $21,885",cppTitle:"CPP Contributions",cppRateText:"Contribution Rate: 5.95%",cppExemptionText:"Basic Exemption: $3,500",cppMaxIncomeText:"Maximum Pensionable Earnings: $71,300",cppMaxContributionText:"Maximum Contribution: $4,034.10",eiTitle:"EI Premiums",eiRateText:"Premium Rate: 1.64%",eiMaxIncomeText:"Maximum Insurable Earnings: $65,700",eiMaxPremiumText:"Maximum Premium: $1,077.48",ccbTitle:"CCB Child Benefit (2025-2026)",ccbMaxAmount:"Maximum Amount (per child):",ccbUnder6:"Under 6: $7,997/year ($666.41/month)",ccb6to17:"6-17 years: $6,748/year ($562.33/month)",ccbNoReduction:"Income ≤ $37,487: Full CCB, no reduction",ccbPhase1Title:"Income $37,487 - $81,222 (Phase 1 Reduction):",ccbPhase1Rates:"1 child: 7% | 2 children: 13.5%",ccbPhase1Rates2:"3 children: 19% | 4+ children: 23%",ccbPhase2Title:"Income > $81,222 (Phase 2 Additional Reduction):",ccbPhase2Rate1:"1 child: $3,061 + 3.2%",ccbPhase2Rate2:"2 children: $5,904 + 5.7%",ccbPhase2Rate3:"3 children: $8,310 + 8%",ccbPhase2Rate4:"4+ children: $10,059 + 9.5%",ccbNote:'Note: CCB is calculated based on "Adjusted Family Net Income". This calculator uses gross income for simplification.',footer:"Data based on 2025 tax rates and benefit standards | For reference only, actual situation may vary based on individual circumstances",thGrossIncome:"Gross Income",thFederalTax:"Federal Tax",thProvincialTax:"Provincial Tax",thCPP:"CPP",thEI:"EI",thNetIncome:"Net Income",thCCB:"CCB",thTotalIncome:"Total Income",thEffectiveRate:"Effective Rate",childLabel:"Child {num} Age",yearsOld:"years old",children0:"0 children",children1:"1 child",children2:"2 children",children3:"3 children",children4:"4 children",children5:"5 children",chartTitle:"Income Comparison Chart (Thousands CAD)",chartLabelGrossIncome:"Gross Income",chartLabelNetPlusCCB:"Net Income + CCB",chartLabelNetIncome:"Net Income",chartLabelCCB:"CCB Child Benefit",chartLabelTaxes:"Federal Tax + AB Provincial Tax",tooltipGrossIncome:"Gross Income: ${amount}",tooltipNetIncome:"Net Income: ${amount}",tooltipFederalTax:"Federal Tax: ${amount}",tooltipProvincialTax:"Provincial Tax: ${amount}",tooltipCPP:"CPP: ${amount}",tooltipEI:"EI: ${amount}",tooltipTotalIncome:"Total Income: ${amount}",tooltipCCBBenefit:"CCB Benefit: ${amount}",tooltipEffectiveRate:"Effective Rate: {rate}%",tooltipTotalDeductions:"Total Deductions: ${amount}",tooltipCCBPercentage:"CCB Percentage: {percent}%",xAxisTitle:"Gross Income (Thousands CAD)",yAxisTitle:"Income (Thousands CAD)"},zh:{mainTitle:"阿尔伯塔省家庭收入分析",subtitle:"单收入家庭 - 2025年",familySettingsTitle:"家庭信息设置",labelNumChildren:"孩子数量",btnCalculate:"更新计算",calculationNotesTitle:"计算说明",familyInfoPrefix:"家庭状况：单收入",familyInfoNoChildren:"家庭状况：单收入，无孩子",familyInfoWithChildren:"家庭状况：单收入，{count}个孩子（{ages}）",includesText:"包含：联邦税、阿尔伯塔省税、CPP、EI",ccbText:"CCB (加拿大儿童福利金) 按当年收入计算",incomeRangeText:"收入范围：$20,000 - $150,000",taxRatesTitle:"2025年税率和福利标准",federalTaxTitle:"联邦税率",federalBPAText:"基本个人免税额: $16,129",albertaTaxTitle:"阿尔伯塔省税率",albertaBPAText:"基本个人免税额: $21,885",cppTitle:"CPP供款",cppRateText:"供款率: 5.95%",cppExemptionText:"基本免税额: $3,500",cppMaxIncomeText:"最大可供款收入: $71,300",cppMaxContributionText:"最大供款: $4,034.10",eiTitle:"EI保险费",eiRateText:"保险费率: 1.64%",eiMaxIncomeText:"最大可保收入: $65,700",eiMaxPremiumText:"最大保险费: $1,077.48",ccbTitle:"CCB儿童福利金 (2025-2026)",ccbMaxAmount:"最大金额（每个孩子）：",ccbUnder6:"6岁以下: $7,997/年 ($666.41/月)",ccb6to17:"6-17岁: $6,748/年 ($562.33/月)",ccbNoReduction:"收入 ≤ $37,487: 全额CCB，无削减",ccbPhase1Title:"收入 $37,487 - $81,222（第1阶段削减）：",ccbPhase1Rates:"1个孩子: 7% | 2个孩子: 13.5%",ccbPhase1Rates2:"3个孩子: 19% | 4个及以上: 23%",ccbPhase2Title:"收入 > $81,222（第2阶段额外削减）：",ccbPhase2Rate1:"1个孩子: $3,061 + 3.2%",ccbPhase2Rate2:"2个孩子: $5,904 + 5.7%",ccbPhase2Rate3:"3个孩子: $8,310 + 8%",ccbPhase2Rate4:"4个及以上: $10,059 + 9.5%",ccbNote:"注：CCB按“调整后家庭净收入”计算，此处简化使用税前收入",footer:"数据基于2025年税率和福利标准 | 仅供参考，实际情况可能因个人具体情况而异",thGrossIncome:"税前收入",thFederalTax:"联邦税",thProvincialTax:"省税",thCPP:"CPP",thEI:"EI",thNetIncome:"税后收入",thCCB:"CCB",thTotalIncome:"总收入",thEffectiveRate:"有效税率",childLabel:"孩子{num}年龄",yearsOld:"岁",children0:"0个孩子",children1:"1个孩子",children2:"2个孩子",children3:"3个孩子",children4:"4个孩子",children5:"5个孩子",chartTitle:"收入对比图 (千加元)",chartLabelGrossIncome:"税前收入",chartLabelNetPlusCCB:"税后收入 + CCB",chartLabelNetIncome:"税后收入",chartLabelCCB:"CCB儿童福利",chartLabelTaxes:"联邦税 + AB省税",tooltipGrossIncome:"税前收入: ${amount}",tooltipNetIncome:"税后收入: ${amount}",tooltipFederalTax:"联邦税: ${amount}",tooltipProvincialTax:"省税: ${amount}",tooltipCPP:"CPP: ${amount}",tooltipEI:"EI: ${amount}",tooltipTotalIncome:"总收入: ${amount}",tooltipCCBBenefit:"CCB福利: ${amount}",tooltipEffectiveRate:"有效税率: {rate}%",tooltipTotalDeductions:"总扣除: ${amount}",tooltipCCBPercentage:"CCB占比: {percent}%",xAxisTitle:"税前收入 (千加元)",yAxisTitle:"收入 (千加元)"}};function a(e){return n[t][e]||e}function o(e){t=e;const o=new URL(window.location);o.searchParams.set("lang",e),window.history.pushState({},"",o),document.documentElement.lang="zh"===e?"zh-CN":"en",document.getElementById("btnEn").classList.toggle("active","en"===e),document.getElementById("btnZh").classList.toggle("active","zh"===e),document.querySelectorAll("[data-i18n]").forEach(e=>{const a=e.getAttribute("data-i18n");void 0!==n[t][a]&&("OPTION"===e.tagName||"BUTTON"===e.tagName||"TH"===e.tagName||"H1"===e.tagName||"H3"===e.tagName||"H4"===e.tagName||"DIV"===e.tagName||"LABEL"===e.tagName||"STRONG"===e.tagName?e.textContent=n[t][a]:e.innerHTML=n[t][a])}),document.getElementById("numChildren").querySelectorAll("option").forEach(e=>{const t="children"+e.value;e.textContent=a(t)}),i(),l(),r()}function i(){const e=parseInt(document.getElementById("numChildren").value),t=document.getElementById("childrenAges");if(0===e)return void(t.innerHTML="");let n='<div class="input-group">';for(let t=1;t<=e;t++){const e=1===t?12:2===t?8:10,o=document.getElementById(`age${t}`),i=o?o.value:e;n+=`\n            <div class="input-field">\n                <label for="age${t}">${a("childLabel").replace("{num}",t)}</label>\n                <select id="age${t}">\n                    ${c(i)}\n                </select>\n            </div>\n        `}n+="</div>",t.innerHTML=n}function c(e){let t="";for(let n=0;n<=17;n++)t+=`<option value="${n}" ${n==e?"selected":""}>${n} ${a("yearsOld")}</option>`;return t}function l(){const e=parseInt(document.getElementById("numChildren").value),n=document.getElementById("familyInfo");if(0===e)return void(n.textContent=a("familyInfoNoChildren"));let o=[];for(let t=1;t<=e;t++){const e=document.getElementById(`age${t}`);if(e){const t=e.value;o.push(`${t}${a("yearsOld")}`)}}const i="zh"===t?"、":", ",c=a("familyInfoWithChildren").replace("{count}",e).replace("{ages}",o.join(i));n.textContent=c}function r(){l();const t=function(){const{under6:e,age6to17:t}=function(){const e=parseInt(document.getElementById("numChildren").value);let t=0,n=0;for(let a=1;a<=e;a++){const e=document.getElementById(`age${a}`);if(e){const a=parseInt(e.value);a<6?t++:a<=17&&n++}}return{under6:t,age6to17:n}}(),n=[];for(let a=2e4;a<=15e4;a+=1e3){const o=s(a),i=d(a,e,t),c=o.netIncome+i;n.push({gross:a,...o,ccb:i,total:c,effectiveRate:(a-o.netIncome)/a*100})}return n}();e&&e.destroy(),function(t){const n=document.getElementById("incomeChart").getContext("2d"),o=window.innerWidth<=768,i=window.innerWidth<=430,c=i?12:o?14:16,l=i?9:o?11:14,r=i?9:o?11:14,d=i?5:o?10:20;e=new Chart(n,{type:"line",data:{labels:t.map(e=>e.gross/1e3),datasets:[{label:a("chartLabelGrossIncome"),data:t.map(e=>e.gross/1e3),borderColor:"rgba(54, 162, 235, 0.8)",backgroundColor:"rgba(54, 162, 235, 0.1)",borderWidth:2,borderDash:[5,5],pointRadius:0,tension:.1,yAxisID:"y"},{label:a("chartLabelNetPlusCCB"),data:t.map(e=>e.total/1e3),borderColor:"rgba(75, 192, 192, 1)",backgroundColor:"rgba(75, 192, 192, 0.2)",borderWidth:3,pointRadius:0,fill:!0,tension:.1,yAxisID:"y"},{label:a("chartLabelNetIncome"),data:t.map(e=>e.netIncome/1e3),borderColor:"rgba(255, 99, 132, 0.6)",backgroundColor:"rgba(255, 99, 132, 0.1)",borderWidth:1.5,pointRadius:0,tension:.1,yAxisID:"y"},{label:a("chartLabelCCB"),data:t.map(e=>e.ccb/1e3),borderColor:"rgba(153, 102, 255, 1)",backgroundColor:"rgba(153, 102, 255, 0.1)",borderWidth:2,pointRadius:0,tension:.1,yAxisID:"y"},{label:a("chartLabelTaxes"),data:t.map(e=>(e.federalTax+e.albertaTax)/1e3),borderColor:"rgba(255, 159, 64, 0.8)",backgroundColor:"rgba(255, 159, 64, 0.1)",borderWidth:1.5,borderDash:[3,3],pointRadius:0,tension:.1,yAxisID:"y"}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:l},padding:d,boxWidth:i?20:40}},title:{display:!0,text:a("chartTitle"),font:{size:c,weight:"bold"},padding:i?10:o?15:20},tooltip:{enabled:!0,mode:"index",intersect:!1,backgroundColor:"rgba(0, 0, 0, 0.9)",padding:o?6:10,position:"nearest",yAlign:function(e){const t=e.chart.height;return e.caretY>t/2?"top":"bottom"},xAlign:function(e){const t=e.chart.width,n=e.caretX;return n<.3*t?"left":n>.7*t?"right":"center"},titleFont:{size:o?10:12,weight:"bold"},bodyFont:{size:o?8:11},bodySpacing:2,displayColors:!0,boxWidth:6,boxHeight:6,caretSize:o?4:5,cornerRadius:4,callbacks:{title:function(e){return`$${((2e4+1e3*e[0].dataIndex)/1e3).toFixed(0)}k`},label:function(e){const t=e.parsed.y,n=e.dataset.label||"";return o?`${n.replace("Gross Income","Gross").replace("Net Income + CCB","Net+CCB").replace("Net Income","Net").replace("CCB Child Benefit","CCB").replace("Federal Tax + AB Provincial Tax","Tax").replace("税前收入","税前").replace("税后收入 + CCB","税后+CCB").replace("税后收入","税后").replace("CCB儿童福利","CCB").replace("联邦税 + AB省税","税")}: $${t.toFixed(0)}k`:`${n}: $${Math.round(1e3*t).toLocaleString("en-CA")}`}}}},scales:{x:{title:{display:!0,text:a("xAxisTitle"),font:{size:r,weight:"bold"}},ticks:{font:{size:i?8:o?10:12},maxRotation:0,minRotation:0},grid:{display:!0,color:"rgba(0, 0, 0, 0.05)"}},y:{title:{display:!0,text:a("yAxisTitle"),font:{size:r,weight:"bold"}},ticks:{font:{size:i?8:o?10:12}},grid:{display:!0,color:"rgba(0, 0, 0, 0.05)"}}}}})}(t),function(e){const t=document.getElementById("tableBody");t.innerHTML="",[2e4,4e4,6e4,8e4,1e5,12e4,15e4].forEach(n=>{const a=e.find(e=>e.gross===n);a&&(t.insertRow().innerHTML=`\n                <td>${m(a.gross)}</td>\n                <td>${m(a.federalTax)}</td>\n                <td>${m(a.albertaTax)}</td>\n                <td>${m(a.cpp)}</td>\n                <td>${m(a.ei)}</td>\n                <td>${m(a.netIncome)}</td>\n                <td>${m(a.ccb)}</td>\n                <td><strong>${m(a.total)}</strong></td>\n                <td>${a.effectiveRate.toFixed(1)}%</td>\n            `)})}(t)}function d(e,t,n){const a=7997*t+6748*n;if(0===a)return 0;if(e<=37487)return a;const o=t+n;let i,c;if(1===o?(i=.07,c=.032):2===o?(i=.135,c=.057):3===o?(i=.19,c=.08):(i=.23,c=.095),e<=81222){const t=(e-37487)*i;return Math.max(0,a-t)}const l=43735*i+(e-81222)*c;return Math.max(0,a-l)}function s(e){const t=Math.max(0,e);let n=(a=t)<=57375?.15*a:a<=114750?8606.25+.205*(a-57375):a<=177882?20368.125+.26*(a-114750):a<=253414?36782.445+.29*(a-177882):58686.725+.33*(a-253414);var a;n=Math.max(0,n-2419.35);let o=function(e){return e<=6e4?.08*e:e<=148269?4800+.1*(e-6e4):e<=177922?13626.9+.12*(e-148269):e<=237230?17185.26+.13*(e-177922):e<=355845?24895.3+.14*(e-237230):41501.4+.15*(e-355845)}(t);o=Math.max(0,o-2188.5);const i=function(e){return e<=3500?0:.0595*(Math.min(e,71300)-3500)}(e),c=function(e){return.0164*Math.min(e,65700)}(e);return{netIncome:e-n-o-i-c,federalTax:n,albertaTax:o,cpp:i,ei:c}}function m(e){return"$"+Math.round(e).toLocaleString("en-CA")}document.addEventListener("DOMContentLoaded",function(){const e=new URLSearchParams(window.location.search).get("lang");t="zh"===e?"zh":"en",o(t);const n=document.getElementById("numChildren");n&&n.addEventListener("change",function(){i(),l()});const a=document.getElementById("btnEn");a&&a.addEventListener("click",function(){o("en")});const c=document.getElementById("btnZh");c&&c.addEventListener("click",function(){o("zh")});const d=document.getElementById("btnCalculate");d&&d.addEventListener("click",function(){r()})});